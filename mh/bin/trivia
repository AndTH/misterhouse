#!/usr/bin/perl
# -*- Perl -*- 
#---------------------------------------------------------------------------
#  File:
#      trivia
#  Description:
#      See help text below
#  Author:
#      Bruce Winter    brucewinter@home.net  http://members.home.net/winters
#  Latest version:
#      http://members.home.net/winters/house/programs
#  Change log:
#    ??/??/98  Created.
#
#---------------------------------------------------------------------------

package trivia;                 # So we can 'do' from other perl code
use strict;

my($Pgm_Path, $Pgm_Name) = $0 =~ /^(.*)[\\\/]([^.]+)/i;
$Pgm_Path  = '.' unless $Pgm_Path;

my $cat = shift;
$cat = 'Science' unless $cat;
$cat = ucfirst $cat;

my $data_dir = "$Pgm_Path/../data/trivia";

                                # Keep track of where the current question number
open (COUNT, "$data_dir/$cat.cnt"); # Don't die ... file may not exist
my $qn = <COUNT>;
close COUNT;
my $file;
open (COUNT, $file = ">$data_dir/$cat.cnt") or die "Error, could not open output file $file: $!\n";
$qn = 0 if $qn > 500;
print COUNT ++$qn;
close COUNT;

my $offset = 0 + 153*($qn-1);

# Pick the trivia category
open (INDATA, $file = "$data_dir/$cat.dat") or die "Error, could not open trivia file $file:$!\n";

open (QUESTION, ">$data_dir/trivia_question.txt");
open (ANSWER, ">$data_dir/trivia_answer.txt");

                                # Read the data
my $r;
read (INDATA, $r, 30);
my $category = substr($r, 0, 20);
print "Searching for question number ", $qn, " in ", $category, " database\n";
print "\n";

                                # Get to the right question
for (my $i = 0; $i < $qn; $i++){
    read (INDATA, $r, 153);
}

                                # Format the output
my $q = substr($r, 0, 70);
my @a;
$a[1] = &trim(substr($r,  72, 20))  . ".";
$a[2] = &trim(substr($r,  92, 20))  . ".";
$a[3] = &trim(substr($r, 112, 20)) . ".";
$a[4] = &trim(substr($r, 132, 20)) . ".";
my $an= substr($r, 152, 1);

print  QUESTION "Todays Trivia Question.\n";
print  QUESTION " $q\n";
#print  QUESTION " ",$q,"[_<1000>]\n";
print  QUESTION "  1: ",$a[1],"\n";
print  QUESTION "  2: ",$a[2],"\n";
print  QUESTION "  3: ",$a[3],"\n";
print  QUESTION "  4: ",$a[4],"\n";
print  QUESTION "  \n";
print  QUESTION "One more time.  The Trivia Question is:\n";
print  QUESTION " $q\n";
print  QUESTION "  1: ",$a[1],"\n";
print  QUESTION "  2: ",$a[2],"\n";
print  QUESTION "  3: ",$a[3],"\n";
print  QUESTION "  4: ",$a[4],"\n";


print  ANSWER "The trivia answer is.\n";
print  ANSWER "  ",$an,": ",$a[$an],".\n";
print  ANSWER "\n";
print  ANSWER "Once again, the trivia answer is.\n";
print  ANSWER "  ",$an,": ",$a[$an],".\n";

close INDATA;
close QUESTION;
close ANSWER;

sub trim {
    my ($string) = @_;
    my (@a);
    @a = split(" ", $string);
    return join(" ",@a);
}

